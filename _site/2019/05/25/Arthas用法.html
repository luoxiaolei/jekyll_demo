<h3 id="简介">简介</h3>
<blockquote>
  <p>Arthas 是Alibaba开源的Java诊断工具，深受开发者喜爱。</p>
</blockquote>

<blockquote>
  <p>当你遇到以下类似问题而束手无策时，Arthas可以帮助你解决：</p>
</blockquote>

<ul>
  <li>这个类从哪个 jar 包加载的？ 为什么会报各种类相关的 Exception？</li>
  <li>我改的代码为什么没有执行到？
难道是我没 commit？分支搞错了？</li>
  <li>遇到问题无法在线上debug，难道只能通过加日志再重新发布吗？</li>
  <li>线上遇到某个用户的数据处理有问题，但线上同样无法 debug，线下无法重现！</li>
  <li>是否有一个全局视角来查看系统的运行状况？</li>
  <li>有什么办法可以监控到JVM的实时运行状态？</li>
</ul>

<h3 id="安装">安装</h3>
<h4 id="快速安装">快速安装</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://alibaba.github.io/arthas/arthas-boot.jar
java -jar arthas-boot.jar
</code></pre></div></div>
<p>aliyun的镜像</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java -jar arthas-boot.jar --repo-mirror aliyun --use-http
</code></pre></div></div>
<p>gitee镜像</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://arthas.gitee.io/arthas-boot.jar
</code></pre></div></div>
<p>Arthas 支持在 Linux/Unix/Mac 等平台上一键安装，请复制以下内容，并粘贴到命令行中，敲 回车 执行即可</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -L https://alibaba.github.io/arthas/install.sh | sh
</code></pre></div></div>
<p>gitee镜像</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -L https://arthas.gitee.io/install.sh | sh
</code></pre></div></div>

<h4 id="全量安装">全量安装</h4>
<ol>
  <li><a href="http://repository.sonatype.org/service/local/artifact/maven/redirect?r=central-proxy&amp;g=com.taobao.arthas&amp;a=arthas-packaging&amp;e=zip&amp;c=bin&amp;v=LATEST">下载</a></li>
  <li>解压后，在文件夹里有arthas-boot.jar，直接用java -jar的方式启动</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java -jar arthas-boot.jar
</code></pre></div></div>

<ol>
  <li>打印帮助信息</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java -jar arthas-boot.jar -h
</code></pre></div></div>

<h4 id="手动安装">手动安装</h4>
<h5 id="linux">Linux</h5>
<ol>
  <li><a href="https://maven.aliyun.com/repository/public/com/taobao/arthas/arthas-packaging/3.x.x/arthas-packaging-3.x.x-bin.zip">下载</a></li>
  <li>解压缩arthas的压缩包
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unzip arthas-packaging-bin.zip
</code></pre></div>    </div>
  </li>
  <li>安装Arthas（注意，这里根据你需要诊断的Java进程的所属用户进行切换）
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo su admin
rm -rf /home/admin/.arthas/lib/*
cd arthas
./install-local.sh
</code></pre></div>    </div>
  </li>
  <li>启动Arthas
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./as.sh
</code></pre></div>    </div>
    <h5 id="windows">Windows</h5>
  </li>
  <li><a href="https://maven.aliyun.com/repository/public/com/taobao/arthas/arthas-packaging/3.x.x/arthas-packaging-3.x.x-bin.zip">下载</a></li>
  <li>解压缩arthas的压缩包</li>
</ol>

<h3 id="基本用法">基本用法</h3>
<ol>
  <li>启用arthas</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java -jar arthas-boot.jar
</code></pre></div></div>

<ol>
  <li>选择应用java进程</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java -jar arthas-boot.jar
* [1]: 35542
  [2]: 71560 arthas-demo.jar
Demo进程是第2个，则输入2，再输入回车/enter
</code></pre></div></div>

<ol>
  <li>查看dashboard</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dashboard
</code></pre></div></div>

<ol>
  <li>通过thread命令来获取到arthas-demo进程的Main Class</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>thread 1
</code></pre></div></div>

<ol>
  <li>通过jad来反编译Main Class</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jad demo.MathGame
</code></pre></div></div>

<ol>
  <li>通过watch命令来查看demo.MathGame#primeFactors函数的返回值</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>watch demo.MathGame primeFactors returnObj
</code></pre></div></div>

<ol>
  <li>退出arthas</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>quit或者exit Attach到目标进程上的arthas还会继续运行，端口会保持开放，下次连接时可以直接连接上。
shutdown 完全退出arthas
</code></pre></div></div>

<h3 id="卸载">卸载</h3>
<h4 id="linux-1">Linux</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rm -rf ~/.arthas/
rm -rf ~/logs/arthas
</code></pre></div></div>

<h4 id="windows-1">Windows</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>直接删除user home下面的.arthas和logs/arthas目录
</code></pre></div></div>

<h3 id="常用命令">常用命令</h3>
<ul>
  <li>sysprop 打印所有的System Properties信息
    <ul>
      <li>sysprop java.version</li>
      <li>
        <table>
          <tbody>
            <tr>
              <td>sysprop</td>
              <td>grep user</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>sysprop testKey testValue</li>
    </ul>
  </li>
  <li>sysenv 命令可以获取到环境变量。和sysprop命令类似。</li>
  <li>jvm 命令会打印出JVM的各种详细信息。</li>
  <li>dashboard 命令可以查看当前系统的实时数据面板。输入 Q 或者 Ctrl+C 可以退出dashboard命令。</li>
  <li>thread 查看所有线程信息</li>
  <li>thread 16 查看线程ID 16的栈：</li>
  <li>thread -n 3 查看CPU使用率top n线程的栈</li>
  <li>thread -n 3 -i 5000 查看5秒内的CPU使用率top n线程栈</li>
  <li>thread -b 查找线程是否有阻塞</li>
  <li>java -jar arthas-boot.jar –target-ip 默认情况下，arthas yourip server侦听的是 127.0.0.1 这个IP，如果希望远程可以访问，可以使用–target-ip的参数。</li>
</ul>

<h3 id="参考链接">参考链接</h3>
<ul>
  <li><a href="https://alibaba.github.io/arthas/index.html">arthas</a></li>
  <li><a href="https://alibaba.github.io/arthas/manual-install.html">手动安装arthas</a></li>
  <li><a href="https://alibaba.github.io/arthas/watch.html">watch用法</a></li>
  <li><a href="https://alibaba.github.io/arthas/arthas-tutorials?language=cn">arthas-tutorials基础教程</a></li>
  <li><a href="https://alibaba.github.io/arthas/arthas-tutorials?language=cn&amp;id=arthas-advanced">arthas-tutorials-advanced进阶教程</a></li>
</ul>
